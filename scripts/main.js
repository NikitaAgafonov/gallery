"use strict";var _module=angular.module("gallery",["ngRoute","cfp.hotkeys"]),url="https://cors-anywhere.herokuapp.com/https://api-fotki.yandex.ru/api/top/?format=json",countImg=49,countImgPage=12,nowPage=0,watchImgId=0,pages=[];_module.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"photos.html",controller:"photos"}).when("/photo:id",{templateUrl:"photo.html",controller:"photo"}).when("/page:num",{templateUrl:"photos.html",controller:"photos"}).otherwise({template:'<h1 class="error">404 NOT FOUND</h1>'})}),_module.config(function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self",url])}),_module.controller("photos",function($scope,$http,$routeParams,$location,$sce,getData){$scope.nowPage=nowPage,$scope.watchImgId=watchImgId,pages[0]?($scope.pages=pages,$routeParams.num&&(nowPage=$routeParams.num-1,$scope.nowPage=$routeParams.num-1)):$http({method:"JSONP",url:url}).then(function(response){$scope.data=response.data.entries,getData.getPages($scope),pages=$scope.pages,$routeParams.num&&(nowPage=$routeParams.num-1,$scope.nowPage=$routeParams.num-1)}).catch(function(err){throw err.status+": "+err.statusText})}),_module.controller("photo",function($scope,$http,$routeParams,$location,$sce,getData,hotkeys){$scope.nowPage=nowPage,$scope.watchImgId=watchImgId;var photoNum=void 0;$scope.selectPhoto=function(num){num?watchImgId<countImg&&(watchImgId++,$location.path("/photo"+watchImgId)):watchImgId>0&&(watchImgId--,$location.path("/photo"+watchImgId))},hotkeys.add({combo:"left",description:"prevPhoto",callback:function(){watchImgId>0&&(watchImgId--,$location.path("/photo"+watchImgId))}}),hotkeys.add({combo:"right",description:"nextPhoto",callback:function(){watchImgId<countImg&&(watchImgId++,$location.path("/photo"+watchImgId))}}),pages[0]?($scope.pages=pages,$routeParams.id&&(watchImgId=$routeParams.id,nowPage=Math.floor(watchImgId/countImgPage),$scope.watchImgId=watchImgId,$scope.nowPage=nowPage,photoNum=watchImgId-nowPage*countImgPage,$scope.photo=$scope.pages[nowPage][photoNum])):$http({method:"JSONP",url:url}).then(function(response){$scope.data=response.data.entries,getData.getPages($scope),pages=$scope.pages,$routeParams.id&&(watchImgId=$routeParams.id,nowPage=Math.floor(watchImgId/countImgPage),$scope.watchImgId=watchImgId,$scope.nowPage=nowPage,photoNum=watchImgId-nowPage*countImgPage,$scope.photo=$scope.pages[nowPage][photoNum])}).catch(function(err){throw err.status+": "+err.statusText})}),_module.factory("getData",function($http){return{getPages:function($scope){$scope.pages=[];for(var j=0,i=0;i<=Math.ceil($scope.data.length/countImgPage)-1;i++){$scope.pages[i]=[];for(var z=0;z<countImgPage&&$scope.data[j];z++)$scope.pages[i].push($scope.data[j]),j++}}}});